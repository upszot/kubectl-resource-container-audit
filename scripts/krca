#!/usr/bin/env python3
# scripts/krca - Punto de entrada principal para KRCA

import sys
from pathlib import Path

# Asegurar que el paquete krca es importable
try:
    # Intentar importar desde la instalación global primero
    from krca import analyze_resources, parse_args, show_help, __version__
except ImportError:
    # Fallback: Añadir el directorio padre al path para desarrollo
    parent_dir = str(Path(__file__).parent.parent.resolve())
    if parent_dir not in sys.path:
        sys.path.insert(0, parent_dir)
    from krca import analyze_resources, parse_args, show_help, __version__

def main():
    """Función principal del punto de entrada"""
    try:
        # Manejo básico para --help y --version
        if len(sys.argv) == 1:
            show_help()
            return 0
        
        if "--help" in sys.argv or "-h" in sys.argv:
            show_help()
            return 0
        
        if "--version" in sys.argv:
            print(f"kubectl-resource-container-audit v{__version__}")
            return 0

        # Parsear argumentos y ejecutar análisis
        args = parse_args()
        return analyze_resources(args)
        
    except KeyboardInterrupt:
        print("\nOperación cancelada por el usuario", file=sys.stderr)
        return 1
    except Exception as e:
        print(f"Error inesperado: {str(e)}", file=sys.stderr)
        if args and getattr(args, 'debug', False):
            import traceback
            traceback.print_exc()
        return 2

if __name__ == "__main__":
    sys.exit(main())
